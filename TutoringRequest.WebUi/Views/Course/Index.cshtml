@using TutoringRequest.Models.DTO.Courses
@using TutoringRequest.Models.DTO.Majors
@model IEnumerable<CourseViewModel>
@{
    ViewData["Title"] = "Course List";
}

<div class="container mt-2">
    <h2 class="mb-4">Courses</h2>
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }
    @if (User.IsInRole("Admin"))
    {
        <a href="@Url.Action("Create", "Course")" class="btn btn-success mb-3">Add Course</a>
    }
    <form method="get">
        <div class="form-group m-1 p-1">
            <label for="majorFilter" class="form-label">Filter by Major:</label>
            <select id="majorFilter" name="majorId" class="form-control border-1" onchange="this.form.submit()">
                <option value="">All Majors</option>
                @foreach (var major in ViewBag.Majors as IEnumerable<MajorDto>)
                {
                    if(ViewBag.SelectedMajorId == major.Id)
                    {
                        <option value="@major.Id" selected="selected">@major.MajorName</option>
                    }
                    else
                    {
                        <option value="@major.Id">@major.MajorName</option>
                    }
                }
            </select>
        </div>
        <div class="input-group m-1 p-1">
            <input type="text" class="form-control" name="searchQuery" placeholder="Search courses" />
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="submit">Search</button>
            </div>
        </div>
    </form>

    <div class="row">
        @if(Model.Count() > 0)
        {
            @foreach (var course in Model)
            {
                <div class="col-md-3 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">@course.Course.CourseName</h5>
                            <p class="card-text">@course.Major.MajorName</p>
                            @if (User.IsInRole("Student") || User.IsInRole("Admin"))
                            {
                                <a href="@Url.Action("Delete", "Course", course.Course)" class="btn btn-info text-white">Schedule</a>
                            }
                            @if (User.IsInRole("Admin"))
                            {
                                <a href="@Url.Action("Delete", "Course", course.Course)" class="btn btn-danger">Delete</a>
                            }
                        </div>
                    </div>
                </div>
            }
        }
        else{
            <h1>No courses were found...</h1>
        }
    </div>
</div>
